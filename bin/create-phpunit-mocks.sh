#!/usr/bin/env bash
set -e

# Define the path for the mock file
MOCK_FILE="tests/phpunit/class-simplesaml-auth-simple.php"

# Create the directory if it doesn't exist
mkdir -p "$(dirname "$MOCK_FILE")"

# Create the mock SimpleSAML_Auth_Simple class file
cat > "$MOCK_FILE" <<-EOF
<?php
// This is a mock class for PHPUnit tests, generated by a script.
if ( ! class_exists( 'SimpleSAML_Auth_Simple' ) ) {
    class SimpleSAML_Auth_Simple {
        // A static property to control the mock's behavior for different tests
        public static \$is_authenticated = false;
        public static \$attributes = [
            'uid' => ['testuser'],
            'mail' => ['test@example.com'],
        ];

        public function __construct( \$auth_source ) {
            // Mock constructor does nothing.
        }

        public function isAuthenticated() {
            return self::\$is_authenticated;
        }

        public function getAttributes() {
            return self::\$attributes;
        }

        public function getLoginURL( \$return_to = '' ) {
            return 'https://example.com/login?return=' . urlencode(\$return_to);
        }

        public function logout( \$return_to = '' ) {
            // Mock logout does nothing.
        }
    }
}
EOF

echo "Successfully created mock file at ${MOCK_FILE}"